<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="frist.css">
  <link rel="icon" href="logo2.png">
  <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCRe227ueVA2xUVbXTB0__Y2uN7BDNZ2o&libraries=places"></script>
  
  <title>Donate. Just Do It MA</title>
  <script>
    // Function to initialize the map
    function initMap() {
      var map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 37.7749, lng: -122.4194 }, // Default to San Francisco
        zoom: 12,
        mapTypeId: 'roadmap', // Default map type
      });

      // Try to get the user's location using Geolocation API
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          var userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          // Set the map center to the user's location
          map.setCenter(userLocation);

          // Create a custom marker for the user's location
          var userMarker = new google.maps.Marker({
            position: userLocation,
            map: map,
            title: 'Your Location',
            icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
          });

          // Fetch the closest hospital using Nominatim API
          fetchClosestHospital(userLocation, map);
        }, function (error) {
          // If the user denies location access or there's an error, use the default location
          console.error('Error getting user location:', error);
          map.setCenter({ lat: 37.7749, lng: -122.4194 });
        });
      } else {
        // Browser doesn't support Geolocation, use the default location
        map.setCenter({ lat: 37.7749, lng: -122.4194 });
      }

      // Add a button to toggle between map styles
      addMapStyleToggle(map);
    }

    // Function to fetch the closest hospital using Nominatim API
    function fetchClosestHospital(userLocation, map) {
      var nominatimUrl = `https://nominatim.openstreetmap.org/reverse?lat=${userLocation.lat}&lon=${userLocation.lng}&format=json`;

      fetch(nominatimUrl)
        .then(response => response.json())
        .then(data => {
          // Extract the hospital information from the response (modify as needed)
          var hospitalName = data.address.hospital || 'Closest Hospital';
          var hospitalLocation = {
            lat: parseFloat(data.lat),
            lng: parseFloat(data.lon)
          };

          // Create a custom marker for the closest hospital
          var hospitalMarker = new google.maps.Marker({
            position: hospitalLocation,
            map: map,
            title: hospitalName,
            icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
          });

          // Add an info window with hospital details
          var hospitalInfoWindow = new google.maps.InfoWindow({
            content: `<div><strong>${hospitalName}</strong><br>Lat: ${hospitalLocation.lat.toFixed(6)}<br>Lng: ${hospitalLocation.lng.toFixed(6)}</div>`
          });

          hospitalMarker.addListener('click', function () {
            hospitalInfoWindow.open(map, hospitalMarker);
          });
        })
        .catch(error => {
          console.error('Error fetching hospital:', error);
        });
    }

    // Function to add a button to toggle between map styles
    function addMapStyleToggle(map) {
      var styleControlDiv = document.createElement('div');
      var styleControl = new MapStyleControl(styleControlDiv, map);

      styleControlDiv.index = 1;
      map.controls[google.maps.ControlPosition.TOP_RIGHT].push(styleControlDiv);
    }

    // Constructor function for MapStyleControl
    function MapStyleControl(controlDiv, map) {
      var controlUI = document.createElement('div');
      controlUI.style.backgroundColor = '#fff';
      controlUI.style.border = '2px solid #fff';
      controlUI.style.borderRadius = '3px';
      controlUI.style.boxShadow = '0 2px 6px rgba(0,0,0,.1)';
      controlUI.style.cursor = 'pointer';
      controlUI.style.marginTop = '10px';
      controlUI.style.textAlign = 'center';
      controlUI.title = 'Click to toggle map style';
      controlDiv.appendChild(controlUI);

      var controlText = document.createElement('div');
      controlText.style.color = 'rgb(25,25,25)';
      controlText.style.fontFamily = 'Roboto,Arial,sans-serif';
      controlText.style.fontSize = '12px';
      controlText.style.lineHeight = '38px';
      controlText.style.paddingLeft = '5px';
      controlText.style.paddingRight = '5px';
      controlText.innerHTML = 'Map Style';
      controlUI.appendChild(controlText);

      controlUI.addEventListener('click', function () {
        toggleMapStyle(map);
      });
    }

    // Function to toggle between map styles
    function toggleMapStyle(map) {
      var currentMapType = map.getMapTypeId();
      var newMapType = (currentMapType === 'roadmap') ? 'satellite' : 'roadmap';
      map.setMapTypeId(newMapType);
    }
  </script>
</head>
<body>
  
  
<!-- Map container -->
<div id="map"></div>
<script defer>
  // Request the user's location when the page loads
  navigator.geolocation.getCurrentPosition(
    function () {
      // Success callback (user granted permission)
      initMap();
    },
    function (error) {
      // Error callback (user denied permission or there was an error)
      console.error('Error getting user location:', error);
    }
  );
</script>

</body>